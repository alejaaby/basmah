<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¤Ø³Ø³Ø© Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø­Ù…ÙŠØ¯ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f0f4f8; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e3a8a;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 8px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen bg-slate-50">

    <div class="max-w-4xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-10 bg-blue-900 text-white p-8 rounded-3xl shadow-xl">
            <h1 class="text-3xl font-bold mb-2">Ù…Ø¤Ø³Ø³Ø© Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø­Ù…ÙŠØ¯ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
            <p class="text-blue-200">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø°ÙƒÙŠ</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap gap-2 mb-6 justify-center">
            <button onclick="showTab('attendance')" class="tab-btn px-6 py-3 bg-blue-900 text-white rounded-full font-bold shadow-md hover:bg-blue-800 transition">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</button>
            <button onclick="showTab('departure')" class="tab-btn px-6 py-3 bg-white text-blue-900 rounded-full font-bold shadow-md hover:bg-blue-50 transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù</button>
            <button onclick="checkAdminAccess()" class="tab-btn px-6 py-3 bg-white text-blue-900 rounded-full font-bold shadow-md hover:bg-blue-50 transition">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <!-- Attendance Section -->
        <div id="attendance" class="tab-content active glass-morphism p-8 rounded-3xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ•’ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
            <div class="space-y-4">
                <input type="text" id="att_emp_id" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" class="w-full p-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none text-center text-xl">
                <button onclick="submitLog('Ø­Ø¶ÙˆØ±')" id="btn_att" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-green-700 transition shadow-lg">Ø¥Ø«Ø¨Ø§Øª Ø­Ø¶ÙˆØ±</button>
            </div>
        </div>

        <!-- Departure Section -->
        <div id="departure" class="tab-content glass-morphism p-8 rounded-3xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸš¶ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</h2>
            <div class="space-y-4">
                <input type="text" id="dep_emp_id" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" class="w-full p-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none text-center text-xl">
                <button onclick="submitLog('Ø§Ù†ØµØ±Ø§Ù')" id="btn_dep" class="w-full bg-red-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-red-700 transition shadow-lg">Ø¥Ø«Ø¨Ø§Øª Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>

        <!-- Registration Section -->
        <div id="register" class="tab-content glass-morphism p-8 rounded-3xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h2>
            <div class="space-y-4">
                <input type="text" id="reg_name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ÙˆØ¸Ù" class="w-full p-4 border border-gray-300 rounded-2xl outline-none">
                <input type="text" id="reg_id" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" class="w-full p-4 border border-gray-300 rounded-2xl outline-none">
                <select id="reg_dept" class="w-full p-4 border border-gray-300 rounded-2xl outline-none">
                    <option>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
                    <option>ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª</option>
                    <option>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                </select>
                <button onclick="registerEmployee()" id="btn_reg" class="w-full bg-blue-900 text-white py-4 rounded-2xl font-bold text-lg hover:bg-blue-800 transition shadow-lg">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>

        <!-- Feedback Modal -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center p-4 z-50 backdrop-blur-sm">
            <div class="bg-white p-8 rounded-3xl max-w-sm w-full text-center shadow-2xl scale-in">
                <div id="modal-icon" class="text-6xl mb-4"></div>
                <h3 id="modal-title" class="text-2xl font-bold mb-2 text-gray-800"></h3>
                <div id="modal-msg" class="text-gray-600 mb-6 leading-relaxed"></div>
                <button onclick="closeModal()" class="w-full bg-blue-900 text-white py-3 rounded-xl font-bold shadow-md hover:bg-blue-800 transition">ÙÙ‡Ù…Øª</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxXk1xHKVMwCZ_AJB0FzRyXEI5PQKo-0kQ9KUoMAdM_NhpMbooqyTgwCO702o2QfTPQ/exec';
        const ADMIN_PASSWORD = '123123';

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.replace('bg-blue-900', 'bg-white');
                btn.classList.replace('text-white', 'text-blue-900');
            });
            event.currentTarget.classList.replace('bg-white', 'bg-blue-900');
            event.currentTarget.classList.replace('text-blue-900', 'text-white');
        }

        function checkAdminAccess() {
            const pass = prompt("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©:");
            if (pass === ADMIN_PASSWORD) showTab('register');
            else showModal('âŒ', 'ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø£Ù…Ø§Ù†', 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø°ÙŠ Ø£Ø¯Ø®Ù„ØªÙ‡ ØºÙŠØ± ØµØ­ÙŠØ­!');
        }

        async function submitLog(type) {
            const fieldId = type === 'Ø­Ø¶ÙˆØ±' ? 'att_emp_id' : 'dep_emp_id';
            const empId = document.getElementById(fieldId).value;
            const btn = document.getElementById(type === 'Ø­Ø¶ÙˆØ±' ? 'btn_att' : 'btn_dep');

            if (!empId) return showModal('âš ï¸', 'Ù†Ù‚Øµ Ø¨ÙŠØ§Ù†Ø§Øª', 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ø£ÙˆÙ„Ø§Ù‹');

            toggleLoading(btn, true);

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'log', type: type, empId: empId })
                });
                
                const res = await response.json();

                if (res.result === 'success') {
                    showModal('ğŸ‘‹', `Ø£Ù‡Ù„Ø§Ù‹ ${res.name}`, 
                        `ØªÙ… ØªØ³Ø¬ÙŠÙ„ <b>${res.type}</b> Ø¨Ù†Ø¬Ø§Ø­.<br><small class="text-blue-500">Ø§Ù„ÙˆÙ‚Øª: ${res.time}</small>`);
                    document.getElementById(fieldId).value = '';
                } else {
                    showModal('ğŸš«', 'Ø¹Ø°Ø±Ø§Ù‹!', res.message);
                }
            } catch (e) {
                showModal('ğŸ“¡', 'Ø®Ø·Ø£ Ø§ØªØµØ§Ù„', 'ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
            } finally {
                toggleLoading(btn, false);
            }
        }

        async function registerEmployee() {
            const name = document.getElementById('reg_name').value;
            const id = document.getElementById('reg_id').value;
            const dept = document.getElementById('reg_dept').value;
            const btn = document.getElementById('btn_reg');

            if (!name || !id) return showModal('âš ï¸', 'Ù†Ù‚Øµ Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©');

            toggleLoading(btn, true);

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'register', name: name, empId: id, department: dept })
                });
                const res = await response.json();
                
                if (res.result === 'success') {
                    showModal('âœ…', 'ØªÙ… Ø§Ù„Ø­ÙØ¸', `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù <b>${name}</b> Ø¨Ù†Ø¬Ø§Ø­.`);
                    document.getElementById('reg_name').value = '';
                    document.getElementById('reg_id').value = '';
                }
            } catch (e) {
                showModal('âŒ', 'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
            } finally {
                toggleLoading(btn, false);
            }
        }

        function showModal(icon, title, msg) {
            document.getElementById('modal-icon').innerText = icon;
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-msg').innerHTML = msg;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        function toggleLoading(btn, isLoading) {
            if (isLoading) {
                btn.disabled = true;
                btn.dataset.oldText = btn.innerHTML;
                btn.innerHTML = `<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...`;
            } else {
                btn.disabled = false;
                btn.innerHTML = btn.dataset.oldText;
            }
        }
    </script>
</body>
</html>
